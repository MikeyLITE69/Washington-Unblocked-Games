<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S0LACE â€¢ Settings</title>

  <link rel="shortcut icon" href="favicon.ico" />
  <link rel="stylesheet" href="index.css" />
  <script src="global-hub.js" defer></script>
  <script src="register-sw.js" defer></script>

  <style>
    /* ------ GRID ------ */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 30px;
    }

    @media (max-width: 1000px) {
      .settings-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 700px) {
      .settings-grid { grid-template-columns: 1fr; }
    }

    .settings-panel {
      border: 2px solid var(--border-hard);
      background: var(--panel);
      padding: 16px;
      box-shadow: 0 0 0 1px #000, 0 0 20px rgba(0,0,0,0.7);
      font-family: "Press Start 2P", monospace;
      font-size: 10px;
    }

    .settings-title {
      font-size: 10px;
      color: var(--accent);
      margin-bottom: 12px;
      text-shadow: 0 0 6px var(--accent);
    }

    .settings-input,
    .settings-select {
      width: 100%;
      padding: 6px 8px;
      margin-top: 4px;
      border: 2px solid var(--border-hard);
      background: #000;
      color: var(--fg);
      font-family: "Press Start 2P";
      font-size: 9px;
    }

    .settings-btn {
      width: 100%;
      margin-top: 8px;
      padding: 6px 10px;
      border: 2px solid var(--accent);
      background: var(--accent-soft);
      font-family: "Press Start 2P";
      font-size: 9px;
      color: var(--accent);
      cursor: pointer;
      text-align: center;
    }

    .settings-btn:hover {
      background: rgba(0,255,127,0.25);
      box-shadow: 0 0 14px rgba(0,255,127,0.6);
    }
  </style>
</head>

<body>
<header class="site-header">
  <div class="site-title">S0LACE</div>
  <nav class="site-nav">
    <a href="index.html">Home</a>
    <a href="games.html">Games</a>
    <a href="media.html">Media</a>
    <a href="settings.html" class="active">Settings</a>
    <a href="account.html" class="account-link">
      <img id="account-icon" alt="Account" />
    </a>
  </nav>
</header>

<main>
  <div class="page-header"><h1>Settings</h1></div>

  <!-- ================= GRID ================= -->
  <div class="settings-grid">

    <!-- ===================================================================== -->
    <!-- TAB CLOAKING (FIXED) -->
    <!-- ===================================================================== -->
    <section class="settings-panel">
      <div class="settings-title">TAB CLOAKING</div>

      <label>Preset</label>
      <select id="cloak-select" class="settings-select">
        <option value="">SELECT...</option>
        <option value="drive">GOOGLE DRIVE</option>
        <option value="schoology">SCHOOLOGY</option>
        <option value="docs">GOOGLE DOCS</option>
        <option value="google">GOOGLE</option>
        <option value="custom">CUSTOM...</option>
      </select>

      <div id="custom-cloak-box" style="display:none; margin-top:12px;">
        <label>Title
          <input id="cloak-title" class="settings-input" placeholder="Custom Title" />
        </label>

        <label>Favicon
          <input id="cloak-icon" class="settings-input" placeholder="https://.../favicon.ico" />
        </label>

        <button class="settings-btn" id="apply-custom-cloak">APPLY</button>
        <button class="settings-btn" id="reset-cloak">RESET</button>
      </div>

      <div id="cloak-status" style="margin-top:6px; font-size:8px; color:var(--fg-dim);"></div>
    </section>

    <!-- ===================================================================== -->
    <!-- APPEARANCE -->
    <!-- ===================================================================== -->
    <section class="settings-panel">
      <div class="settings-title">APPEARANCE</div>

      <label>Theme</label>
      <select id="theme-select" class="settings-select">
        <option value="dark">DARK</option>
        <option value="baby">BLUE</option>
        <option value="xmas">GREEN</option>
      </select>

      <label style="margin-top:12px;">Accent Color</label>
      <select id="accent-select" class="settings-select">
        <option value="green">GREEN</option>
        <option value="violet">VIOLET</option>
        <option value="amber">AMBER</option>
        <option value="white">WHITE</option>
      </select>
    </section>

    <!-- ===================================================================== -->
    <!-- BACKGROUND -->
    <!-- ===================================================================== -->
    <section class="settings-panel">
      <div class="settings-title">BACKGROUND</div>

      <label>Mode</label>
      <select id="bg-mode" class="settings-select">
        <option value="default">DEFAULT (CRT)</option>
        <option value="gif-stars">STARRY GIF</option>
        <option value="custom">CUSTOM</option>
      </select>

      <div id="bg-url-row" style="display:none; margin-top:12px;">
        <label>Image URL
          <input id="bg-url" class="settings-input" placeholder="https://example.com/bg.png" />
        </label>
      </div>
    </section>

    <!-- ===================================================================== -->
    <!-- SECURITY -->
    <!-- ===================================================================== -->
    <section class="settings-panel">
      <div class="settings-title">SECURITY</div>

      <label><input type="checkbox" id="anti-close-toggle" />SECURLY + BLOCKSI BLOCKER (ANTI-CLOSE)</label>

      <button class="settings-btn" id="blank-launch">LAUNCH IN ABOUT:BLANK</button>
    </section>

    <!-- ===================================================================== -->
    <!-- LINKS -->
    <!-- ===================================================================== -->
    <section class="settings-panel">
      <div class="settings-title">INFO / SUPPORT</div>
      <a href="about.html"><button class="settings-btn">ABOUT US</button></a>
      <a href="dmca.html"><button class="settings-btn">DMCA FORM</button></a>
    </section>

    <!-- ===================================================================== -->
    <!-- STORAGE -->
    <!-- ===================================================================== -->
    <section class="settings-panel">
      <div class="settings-title">STORAGE</div>

      <button class="settings-btn" id="btn-reset-settings">RESET SETTINGS</button>
      <button class="settings-btn" id="btn-clear-media">CLEAR MEDIA CACHE</button>
    </section>

  </div>
</main>

<script>
/* ----------------- FIXED PRESETS ----------------- */
const PRESETS = {
  drive: {
    enabled: true,
    title: "My Drive - Google Drive",
    iconHref: "https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png"
  },
  schoology: {
    enabled: true,
    title: "Schoology",
    iconHref: "https://asset-cdn.schoology.com/sites/all/themes/schoology_theme/favicon.ico"
  },
  docs: {
    enabled: true,
    title: "Google Docs",
    iconHref: "https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico"
  },
  google: {
    enabled: true,
    title: "Google",
    iconHref: "favicon.ico"
  }
};

const cloakSelect = document.getElementById("cloak-select");
const customBox   = document.getElementById("custom-cloak-box");
const titleInput  = document.getElementById("cloak-title");
const iconInput   = document.getElementById("cloak-icon");
const applyCustomBtn = document.getElementById("apply-custom-cloak");
const resetBtn       = document.getElementById("reset-cloak");
const statusEl       = document.getElementById("cloak-status");

function saveAndApplyCloak(cfg) {
  cfg.enabled = true;
  window.S0LACE.applyTabCloak(cfg, true);
  localStorage.setItem("s0laceTabCloak", JSON.stringify(cfg));
  statusEl.textContent = "Cloak applied.";
}

cloakSelect.addEventListener("change", () => {
  const val = cloakSelect.value;

  if (val === "custom") {
    customBox.style.display = "block";
    return;
  }

  customBox.style.display = "none";

  if (PRESETS[val]) {
    saveAndApplyCloak(PRESETS[val]);
  }
});

applyCustomBtn.addEventListener("click", () => {
  const cfg = {
    enabled: true,
    title: titleInput.value.trim(),
    iconHref: iconInput.value.trim()
  };
  if (!cfg.title) return statusEl.textContent = "Title required.";
  saveAndApplyCloak(cfg);
});

resetBtn.addEventListener("click", () => {
  window.S0LACE.clearTabCloak(true);
  localStorage.removeItem("s0laceTabCloak");
  statusEl.textContent = "Cloak reset.";
});

/* ----------------- APPEARANCE ----------------- */
document.getElementById("theme-select").addEventListener("change", e => {
  window.S0LACE.applyTheme(e.target.value, true);
});

document.getElementById("accent-select").addEventListener("change", e => {
  window.S0LACE.applyAccent(e.target.value, true);
});

/* ----------------- BACKGROUND ----------------- */
const bgMode = document.getElementById("bg-mode");
const bgUrlRow = document.getElementById("bg-url-row");
const bgUrlInput = document.getElementById("bg-url");

bgMode.addEventListener("change", () => {
  const m = bgMode.value;
  bgUrlRow.style.display = m === "custom" ? "block" : "none";

  const url = m === "custom" ? bgUrlInput.value.trim() : "";
  window.S0LACE.applyBackground(m, url, true);
});

/* ----------------- SECURITY ----------------- */
const antiToggle = document.getElementById("anti-close-toggle");
antiToggle.checked = localStorage.getItem("s0laceAntiClose") === "1";

antiToggle.addEventListener("change", e => {
  if (e.target.checked) window.S0LACE.enableAntiClose();
  else window.S0LACE.disableAntiClose();
});

document.getElementById("blank-launch").addEventListener("click", () => {
  const win = window.open("about:blank", "_blank");
  if (!win) return alert("Popup blocked.");

  win.document.write(`
    <style>
      body { margin:0; background:black; display:flex; align-items:center; justify-content:center; }
      iframe { width:100vw; height:100vh; border:none; }
    </style>
    <iframe src="${location.origin}/index.html"></iframe>
  `);
});

/* ----------------- STORAGE ----------------- */
document.getElementById("btn-reset-settings").addEventListener("click", () => {
  if (!confirm("Reset ALL settings?")) return;

  [
    "s0laceTabCloak",
    "s0laceAccent",
    "s0laceTheme",
    "s0laceBgMode",
    "s0laceBgUrl",
    "s0laceAntiClose",
    "s0laceStartupBlank",
    "s0laceMediaCache"
  ].forEach(k => localStorage.removeItem(k));

  location.reload();
});

document.getElementById("btn-clear-media").addEventListener("click", () => {
  localStorage.removeItem("s0laceMediaCache");
  alert("Media cache cleared.");
});
</script>

</body>
</html>
